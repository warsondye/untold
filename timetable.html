<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study Timetable</title>
  <style>
  /* Base Styles (Light Mode) */
body {
  font-family: Arial, sans-serif;
  background-color: #f4f6f8;
  color: #333;
  margin: 0;
  padding: 20px;
}

.container {
  max-width: 600px;
  margin: auto;
  background-color: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

h1, h2 {
  color: #2e7d32;
}

button {
  background-color: #2e7d32;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #1b5e20;
}

/* Dark Mode Styles */
body.dark-mode {
  background-color: #121212;
  color: #f4f6f8;
}

body.dark-mode .container {
  background-color: #333;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

body.dark-mode h1, body.dark-mode h2 {
  color: #81c784; /* Light green for headings */
}

body.dark-mode button {
  background-color: #81c784;
}

body.dark-mode button:hover {
  background-color: #66bb6a;
}

/* Input, select, and text areas */
input, select, textarea {
  background-color: #555;
  color: #f4f6f8;
  border: 1px solid #777;
  padding: 10px;
  border-radius: 8px;
}

body.dark-mode input, body.dark-mode select, body.dark-mode textarea {
  background-color: #666;
  color: #fff;
  border: 1px solid #888;
}

    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; margin: 0; }
    .container { background: #fff; padding: 20px; border-radius: 10px; max-width: 700px; margin: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { color: #2e7d32; text-align: center; margin-bottom: 20px; }
    input, select, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 16px; }
    button { background: #2e7d32; color: white; border: none; cursor: pointer; }
    button:hover { background: #1b5e20; }
    .countdown { font-weight: bold; margin-top: 20px; }
    .alert { color: red; font-size: 14px; }
    ul { padding-left: 0; }
    li { margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #fafafa; border-radius: 5px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
    .timetable-buttons { display: flex; gap: 10px; }
    .timetable-buttons button { background: #007bff; }
    .timetable-buttons button:hover { background: #0056b3; }
    .day-header { font-weight: bold; margin-top: 30px; font-size: 18px; color: #2e7d32; }
    .day-section { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Study Timetable</h2>

    <!-- Add/Edit Timetable Form -->
    <input type="text" id="subject" placeholder="Subject">
    <input type="time" id="time" placeholder="time">
    <select id="day">
      <option value="">Select Day</option>
      <option>Sunday</option><option>Monday</option><option>Tuesday</option>
      <option>Wednesday</option><option>Thursday</option><option>Friday</option><option>Saturday</option>
    </select>
    <button onclick="addOrEditClass()">Add Class</button>
    <div class="alert" id="alert"></div>

    <!-- Timetable List -->
    <div id="timetable-list"></div>

    <!-- Countdown -->
    <div class="countdown" id="countdown"></div>
  </div>

  <!-- Sound Alert -->
  <audio id="alertSound" src="https://www.soundjay.com/buttons/sounds/beep-07.mp3" preload="auto"></audio>
<script src="settings.js"></script>
  <script>
    const timetable = JSON.parse(localStorage.getItem("timetable")) || [];
    const list = document.getElementById("timetable-list");
    const alertSound = document.getElementById("alertSound");
    let editingIndex = -1;

    if ("Notification" in window) Notification.requestPermission();

    // Sort timetable by day of the week
    const daysOrder = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    function sortTimetable() {
      timetable.sort((a, b) => {
        return daysOrder.indexOf(a.day) - daysOrder.indexOf(b.day);
      });
    }

    // Render timetable grouped by day
    function render() {
      sortTimetable();
      list.innerHTML = '';
      let currentDay = "";

      timetable.forEach((item, index) => {
        if (currentDay !== item.day) {
          currentDay = item.day;
          const dayHeader = document.createElement("div");
          dayHeader.classList.add("day-header");
          dayHeader.textContent = currentDay;
          list.appendChild(dayHeader);
        }

        const li = document.createElement("li");
        li.innerHTML = `${item.subject} at ${item.time}`;

        // Edit and Delete Buttons
        const buttons = document.createElement("div");
        buttons.classList.add("timetable-buttons");

        const editBtn = document.createElement("button");
        editBtn.innerText = "Edit";
        editBtn.onclick = () => editClass(index);

        const delBtn = document.createElement("button");
        delBtn.innerText = "Delete";
        delBtn.onclick = () => delClass(index);

        buttons.append(editBtn, delBtn);
        li.appendChild(buttons);
        const daySection = document.createElement("div");
        daySection.classList.add("day-section");
        daySection.appendChild(li);
        list.appendChild(daySection);
      });
    }

    // Add or Edit a class
    function addOrEditClass() {
      const subject = document.getElementById("subject").value;
      const time = document.getElementById("time").value;
      const day = document.getElementById("day").value;

      if (!subject || !time || !day) {
        document.getElementById("alert").textContent = "Please fill in all fields!";
        return;
      }

      if (editingIndex === -1) {
        timetable.push({ subject, time, day });
      } else {
        timetable[editingIndex] = { subject, time, day };
        editingIndex = -1;
      }

      localStorage.setItem("timetable", JSON.stringify(timetable));
      render();
      clearForm();
    }

    // Edit a class
    function editClass(index) {
      const entry = timetable[index];
      document.getElementById("subject").value = entry.subject;
      document.getElementById("time").value = entry.time;
      document.getElementById("day").value = entry.day;
      editingIndex = index;
      document.querySelector("button").textContent = "Save Changes";
    }

    // Delete a class
    function delClass(index) {
      if (confirm("Are you sure you want to delete this class?")) {
        timetable.splice(index, 1);
        localStorage.setItem("timetable", JSON.stringify(timetable));
        render();
      }
    }

    // Clear form and reset button text
    function clearForm() {
      document.getElementById("subject").value = '';
      document.getElementById("time").value = '';
      document.getElementById("day").value = '';
      document.querySelector("button").textContent = "Add Class";
    }

    // Get next class
    function getNextClass() {
      const now = new Date();
      const daysMap = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

      let upcoming = timetable.map(entry => {
        const dayIndex = daysMap.indexOf(entry.day);
        let classDate = new Date();
        classDate.setHours(...entry.time.split(":").map(Number), 0, 0);

        const diff = (dayIndex - now.getDay() + 7) % 7;
        classDate.setDate(now.getDate() + diff);
        if (diff === 0 && classDate <= now) classDate.setDate(classDate.getDate() + 7);

        return { ...entry, classDate };
      });

      upcoming = upcoming.sort((a, b) => a.classDate - b.classDate);
      return upcoming[0];
    }

    let notified = false;

    // Update countdown
    function updateCountdown() {
      const now = new Date();
      const next = getNextClass();

      if (!next) {
        document.getElementById("countdown").textContent = "No upcoming class.";
        return;
      }

      const diffMs = next.classDate - now;
      if (diffMs < 0) return;

      const mins = Math.floor((diffMs / 1000 / 60) % 60);
      const hrs = Math.floor((diffMs / 1000 / 60 / 60));
      const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));

      const timeText = `${days > 0 ? days + 'd ' : ''}${hrs % 24}h ${mins}m`;
      document.getElementById("countdown").textContent = `Next class: ${next.subject} on ${next.day} at ${next.time} â€” in ${timeText}`;

      if (diffMs <= 5 * 60 * 1000 && !notified) {
        if (Notification.permission === "granted") {
          new Notification("Class Reminder", {
            body: `${next.subject} starts in 5 minutes.`,
            icon: "https://cdn-icons-png.flaticon.com/512/4299/4299934.png"
          });
        }
        alertSound.play();
        notified = true;
      }

      if (diffMs > 5 * 60 * 1000) notified = false;
    }

    render();
    updateCountdown();
    setInterval(updateCountdown, 1000);
  </script>
</body>
</html>
